# EMQX 到 Logstash 的消息转发配置
# 用途: 将 EMQX 的 MQTT 消息转发到 Logstash 进行存储和分析

# 将所有 MQTT 消息转发到 Logstash
[[bridges.mqtt]]
name = "logstash_bridge"
enable = true
connector {
  # Logstash 使用 HTTP 输入
  proto_ver = "v5"
  name = "logstash_connector"
  server = "logstash:5000"
  mode = "client"
  username = "emqx"
  password = "emqx123"
}

# 订阅所有主题
remote_topic {
  remote_prefix = ""
  local_prefix = ""
  qos = 1
  retain = "disabled"
}

# 或者使用 HTTP Webhook 方式（更简单）
[[bridges.webhook]]
name = "logstash_webhook"
enable = true
url = "http://logstash:5000/emqx"
method = "post"
headers = { "Content-Type" = "application/json" }

# 模板：构建 JSON 消息
body = """
{
  "topic": "${topic}",
  "payload": "${payload}",
  "qos": ${qos},
  "retain": ${retain},
  "clientid": "${clientid}",
  "username": "${username}",
  "timestamp": ${timestamp},
  "node": "${node}"
}
"""

# 发送所有主题的消息
local_topic = "#"
